FROM node:24-alpine

RUN apk add --no-cache \
    git \
    openssh-client \
    bash \
    tini \
    wget

WORKDIR /repos

ENV HOST=0.0.0.0
ENV PORT=3456
EXPOSE 3456

# Keep compatibility with Dokploy health checks
HEALTHCHECK --interval=30s --timeout=5s --start-period=20s --retries=3 \
  CMD wget --quiet --tries=1 --spider "http://localhost:${PORT:-3456}" || exit 1

ENTRYPOINT ["/sbin/tini", "--"]
CMD ["npx", "-y", "vibe-kanban@latest"]
